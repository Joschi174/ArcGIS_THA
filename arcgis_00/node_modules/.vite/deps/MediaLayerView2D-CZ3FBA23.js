import {
  d as d3,
  f as f3
} from "./chunk-GJ4AX7TK.js";
import "./chunk-U2S7VD5E.js";
import "./chunk-MEGV3NFQ.js";
import "./chunk-PH2HQMHS.js";
import "./chunk-DILKCB2X.js";
import "./chunk-5EHLOJ6Z.js";
import "./chunk-6HXKIKIT.js";
import "./chunk-XQSFOYTA.js";
import {
  i as i5,
  w
} from "./chunk-XGFXC7IN.js";
import {
  i as i4
} from "./chunk-2YLUDNP5.js";
import "./chunk-44OKOXKA.js";
import "./chunk-OW4XGQQP.js";
import "./chunk-64NBUS2F.js";
import "./chunk-JUYJSPTR.js";
import {
  i as i3,
  j
} from "./chunk-EJGRDNGS.js";
import "./chunk-5OU4ZQ43.js";
import "./chunk-IFHU7PKI.js";
import "./chunk-FE2XXDCR.js";
import {
  c as c2,
  u
} from "./chunk-MYZ743ND.js";
import {
  T as T2,
  e2 as e4
} from "./chunk-4GVOVKVX.js";
import "./chunk-V66LHQVK.js";
import "./chunk-AER5JAFS.js";
import "./chunk-FKEHFW5J.js";
import "./chunk-7HZ72XIE.js";
import "./chunk-X2LY67RQ.js";
import "./chunk-MT6BDG6P.js";
import "./chunk-4O2QGREW.js";
import "./chunk-P662BGUZ.js";
import "./chunk-PM77FW2O.js";
import "./chunk-RNMDDDND.js";
import "./chunk-E7T34AFG.js";
import {
  r as r6
} from "./chunk-U3JB4DA4.js";
import "./chunk-VR7WK7TF.js";
import "./chunk-BQJY56X4.js";
import "./chunk-4XXKLC7H.js";
import "./chunk-NVZXNBIH.js";
import "./chunk-K6D7DQGC.js";
import "./chunk-CN3PB7HS.js";
import "./chunk-SQZ7ON7Z.js";
import "./chunk-ZL3HOHNK.js";
import "./chunk-DSVPEX7K.js";
import "./chunk-PX3Q44FM.js";
import "./chunk-XYJMHUDA.js";
import "./chunk-CSLWFQJE.js";
import "./chunk-PR2OEILG.js";
import "./chunk-XP6ESZGI.js";
import "./chunk-JKPERUTC.js";
import "./chunk-A4HFWKMU.js";
import "./chunk-TDXHXKUI.js";
import "./chunk-BBJLFBMQ.js";
import "./chunk-AZ4FK2MA.js";
import "./chunk-EULDPA4O.js";
import "./chunk-IVABPLLZ.js";
import {
  T
} from "./chunk-TBHRKIAA.js";
import "./chunk-FF5LS3YE.js";
import {
  D,
  F
} from "./chunk-BCDDCNQ2.js";
import {
  e as e2
} from "./chunk-EF6YPOUN.js";
import "./chunk-GLQ6HYRE.js";
import "./chunk-OARQV2FW.js";
import {
  v
} from "./chunk-C4L2TGDU.js";
import "./chunk-325OL72R.js";
import "./chunk-EIIX6MK3.js";
import "./chunk-WTKN55TU.js";
import "./chunk-TDPKDZC3.js";
import "./chunk-M5UHI5WR.js";
import "./chunk-R6HT3QM2.js";
import "./chunk-QOWAKGE4.js";
import "./chunk-5CJTGLZW.js";
import "./chunk-SO7CVIZK.js";
import "./chunk-YAWND7HF.js";
import "./chunk-FJYIB7HF.js";
import "./chunk-3QLIFMET.js";
import "./chunk-4N7RZBXD.js";
import {
  ut
} from "./chunk-GWVPJQ6L.js";
import "./chunk-UOQERNSF.js";
import {
  e as e3
} from "./chunk-D5NSNTGJ.js";
import {
  n as n2
} from "./chunk-GTOF2BJC.js";
import "./chunk-FQZ2JEHK.js";
import "./chunk-D4SJZ5KN.js";
import {
  r as r5
} from "./chunk-A7XI44IB.js";
import {
  y as y2
} from "./chunk-R7L5PZPI.js";
import "./chunk-QNFDBY7V.js";
import "./chunk-EL72ISXP.js";
import {
  t as t2
} from "./chunk-5KLICR5E.js";
import "./chunk-CKSC27NP.js";
import "./chunk-OVFWVPXL.js";
import "./chunk-WNYS35QN.js";
import "./chunk-VFUAVCAY.js";
import {
  n
} from "./chunk-VZAEQ6CY.js";
import {
  M as M2,
  f as f2,
  h as h2,
  i as i2,
  r as r4
} from "./chunk-SS33L3LC.js";
import {
  r as r3
} from "./chunk-X4Y5OF5X.js";
import "./chunk-PT3MUKWE.js";
import "./chunk-GZTLZ6RD.js";
import "./chunk-6ALTXU4U.js";
import "./chunk-UIMMV4OY.js";
import "./chunk-QZ4HHFPF.js";
import "./chunk-VRNAR2BU.js";
import "./chunk-IAMROCVA.js";
import "./chunk-7L7U6YJ3.js";
import "./chunk-QXLGW66I.js";
import "./chunk-YGH3EEG5.js";
import "./chunk-H7EOZY7L.js";
import "./chunk-LKYCF7AI.js";
import "./chunk-DDZ6WPWX.js";
import "./chunk-FHYNSVC4.js";
import "./chunk-4HDCOJ24.js";
import "./chunk-VY2MIGMV.js";
import "./chunk-R5EWWIOD.js";
import "./chunk-52L3OT7H.js";
import "./chunk-NHDVBH5V.js";
import "./chunk-WLU7KKOI.js";
import "./chunk-BA7WNJMF.js";
import "./chunk-ZZQVVHF7.js";
import "./chunk-SCOBW7KR.js";
import "./chunk-AHAGGZUI.js";
import "./chunk-HVBIBP5P.js";
import "./chunk-JGFWZDK3.js";
import "./chunk-U4IWFNWD.js";
import "./chunk-6L4U2AW6.js";
import "./chunk-RFIIU6XF.js";
import "./chunk-DGADM4KQ.js";
import "./chunk-4CZO65BK.js";
import "./chunk-7C7EF3FD.js";
import "./chunk-PQOGMOZ7.js";
import "./chunk-XMS7FYO7.js";
import "./chunk-HOGRNOD4.js";
import "./chunk-NZY6MEON.js";
import "./chunk-Z74XNIJ3.js";
import "./chunk-GRS3EHGG.js";
import "./chunk-Y2CLYMXQ.js";
import {
  c
} from "./chunk-EIE3W25Z.js";
import "./chunk-TNYMHVJ4.js";
import "./chunk-OZXJDVTE.js";
import "./chunk-Z6HMRH7V.js";
import "./chunk-JZBA2N4X.js";
import "./chunk-HABV4VZ2.js";
import "./chunk-2D2437VM.js";
import "./chunk-YIIAB4WA.js";
import "./chunk-KTSEQWMB.js";
import "./chunk-FUHI6TR6.js";
import "./chunk-BRRN7CRU.js";
import "./chunk-TLIPFBCN.js";
import "./chunk-7KTXAH5E.js";
import "./chunk-WYE6B4VU.js";
import "./chunk-RHW56URE.js";
import "./chunk-5XLKQQPP.js";
import "./chunk-JUHOAKXP.js";
import "./chunk-X5ASTC4J.js";
import "./chunk-3OL5L3LC.js";
import {
  V
} from "./chunk-RNYFZDNI.js";
import "./chunk-FBG4WSP5.js";
import "./chunk-G3X4SV7G.js";
import "./chunk-AJM6LB5B.js";
import "./chunk-G4LADD2B.js";
import "./chunk-HLTEFNTE.js";
import "./chunk-CO3TM5QL.js";
import {
  i
} from "./chunk-FARQZCLL.js";
import {
  o
} from "./chunk-MOPR7RFH.js";
import "./chunk-KW3ZNPTA.js";
import "./chunk-TJB4CGOM.js";
import {
  M,
  s as s3,
  x
} from "./chunk-E5XSQEGK.js";
import "./chunk-MZXYP6SL.js";
import {
  d as d2
} from "./chunk-4X5MDDUC.js";
import "./chunk-UURR7HU3.js";
import "./chunk-JLE6P4DW.js";
import "./chunk-CL7UAIKB.js";
import {
  a as a2,
  f,
  h,
  l
} from "./chunk-F3SBJW2O.js";
import "./chunk-YVCC2Z32.js";
import "./chunk-ODFH3BSN.js";
import "./chunk-YC3PYTAZ.js";
import "./chunk-46JSCFRH.js";
import "./chunk-JZM5YUHA.js";
import "./chunk-VPF2CM6B.js";
import "./chunk-JCWF5RB4.js";
import {
  y
} from "./chunk-TBBTJ7N4.js";
import "./chunk-NUI5LCQ5.js";
import {
  a2 as a
} from "./chunk-AS7ITRBV.js";
import {
  e
} from "./chunk-PD5Q7TDW.js";
import {
  r
} from "./chunk-SF7FIURP.js";
import "./chunk-K7YQIZQM.js";
import "./chunk-H3ETM4DZ.js";
import "./chunk-TXAS6RAG.js";
import {
  d,
  r as r2
} from "./chunk-G72U56FP.js";
import {
  t
} from "./chunk-DWOEYHKS.js";
import {
  s2 as s,
  s3 as s2
} from "./chunk-JGYHKABU.js";
import "./chunk-3FXB2ZFK.js";
import "./chunk-WQNVH5M4.js";
import "./chunk-76J2PTFD.js";

// node_modules/@arcgis/core/views/2d/engine/webgl/Overlay.js
var j2 = e2();
var _ = class extends i4 {
  constructor(s4) {
    super(), this.elementView = s4, this.isWrapAround = false, this.perspectiveTransform = n(), this._vertices = new Float32Array(20), this._handles = [], this._handles.push(l(() => this.elementView.element.opacity, (e5) => this.opacity = e5, h), l(() => [this.elementView.coords], () => {
      this.requestRender();
    }, h), f(() => this.elementView.element.loaded, () => {
      const e5 = this.elementView.element;
      this.ready(), "video" === e5.type && null != e5.content && this._handles.push(r2(e5.content, "play", () => this.requestRender()));
    }, h)), s4.element.load().catch((t3) => {
      s.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new s2("element-load-error", "Element cannot be displayed", { element: s4, error: t3 }));
    });
  }
  destroy() {
    this._handles.forEach((e5) => e5.remove()), this.texture = t(this.texture);
  }
  get dvsMat3() {
    return this.parent.dvsMat3;
  }
  beforeRender(e5) {
    const { context: t3 } = e5, r7 = this.elementView.element.content;
    if (null != r7) {
      const e6 = r7 instanceof HTMLImageElement, i6 = r7 instanceof HTMLVideoElement, o2 = e6 ? r7.naturalWidth : i6 ? r7.videoWidth : r7.width, n3 = e6 ? r7.naturalHeight : i6 ? r7.videoHeight : r7.height;
      if (this._updatePerspectiveTransform(o2, n3), this.texture)
        i6 && !r7.paused && (this.texture.setData(r7), this.requestRender(), (t3.type === n2.WEBGL2 || o(o2) && o(n3)) && this.texture.generateMipmap());
      else {
        const e7 = new e4();
        e7.wrapMode = D.CLAMP_TO_EDGE, e7.preMultiplyAlpha = true, e7.width = o2, e7.height = n3, this.texture = new T2(t3, e7, r7), (t3.type === n2.WEBGL2 || o(o2) && o(n3)) && this.texture.generateMipmap(), i6 && !r7.paused && this.requestRender();
      }
    }
    super.beforeRender(e5);
  }
  _createTransforms() {
    return null;
  }
  updateDrawCoords(e5, t3) {
    const r7 = this.elementView.coords;
    if (null == r7)
      return;
    const [s4, i6, o2, n3] = r7.rings[0], a3 = this._vertices, { x: m, y: h3 } = e5, l2 = 0 !== t3;
    l2 ? a3.set([i6[0] - m, i6[1] - h3, s4[0] - m, s4[1] - h3, o2[0] - m, o2[1] - h3, n3[0] - m, n3[1] - h3, n3[0] - m, n3[1] - h3, i6[0] + t3 - m, i6[1] - h3, i6[0] + t3 - m, i6[1] - h3, s4[0] + t3 - m, s4[1] - h3, o2[0] + t3 - m, o2[1] - h3, n3[0] + t3 - m, n3[1] - h3]) : a3.set([i6[0] - m, i6[1] - h3, s4[0] - m, s4[1] - h3, o2[0] - m, o2[1] - h3, n3[0] - m, n3[1] - h3]), this.isWrapAround = l2;
  }
  getVAO(e5, t3, r7) {
    if (null == this.elementView.coords)
      return null;
    const s4 = this._vertices;
    if (this._vao)
      this._geometryVbo.setData(s4);
    else {
      this._geometryVbo = c2.createVertex(e5, F.DYNAMIC_DRAW, s4);
      const i6 = c2.createVertex(e5, F.STATIC_DRAW, new Uint16Array([0, 0, 0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0, 1, 1, 0, 1, 1]));
      this._vao = new u(e5, r7, t3, { geometry: this._geometryVbo, tex: i6 });
    }
    return this._vao;
  }
  _updatePerspectiveTransform(e5, t3) {
    const r7 = this._vertices;
    j(j2, [0, 0, e5, 0, 0, t3, e5, t3], [r7[0], r7[1], r7[4], r7[5], r7[2], r7[3], r7[6], r7[7]]), r3(this.perspectiveTransform, j2[6] / j2[8] * e5, j2[7] / j2[8] * t3);
  }
};

// node_modules/@arcgis/core/views/2d/engine/webgl/OverlayContainer.js
var u2 = class extends i5 {
  constructor() {
    super(...arguments), this._localOrigin = c(0, 0), this._viewStateId = -1, this._dvsMat3 = e3(), this.requiresDedicatedFBO = false;
  }
  get dvsMat3() {
    return this._dvsMat3;
  }
  beforeRender(t3) {
    this._updateMatrices(t3), this._updateOverlays(t3, this.children);
    for (const e5 of this.children)
      e5.beforeRender(t3);
  }
  prepareRenderPasses(t3) {
    const e5 = t3.registerRenderPass({ name: "overlay", brushes: [w.overlay], target: () => this.children, drawPhase: T.MAP });
    return [...super.prepareRenderPasses(t3), e5];
  }
  _updateMatrices(t3) {
    const { state: i6 } = t3, { id: d4, size: l2, pixelRatio: h3, resolution: m, rotation: f4, viewpoint: u3, displayMat3: M3 } = i6;
    if (this._viewStateId === d4)
      return;
    const v3 = Math.PI / 180 * f4, _3 = h3 * l2[0], w3 = h3 * l2[1], { x: g, y: y3 } = u3.targetGeometry, j3 = v(g, i6.spatialReference);
    this._localOrigin.x = j3, this._localOrigin.y = y3;
    const R2 = m * _3, b2 = m * w3, O = r4(this._dvsMat3);
    i2(O, O, M3), M2(O, O, t2(_3 / 2, w3 / 2)), f2(O, O, r6(_3 / R2, -w3 / b2, 1)), h2(O, O, -v3), this._viewStateId = d4;
  }
  _updateOverlays(t3, e5) {
    const { state: s4 } = t3, { rotation: r7, spatialReference: o2, worldScreenWidth: a3, size: i6, viewpoint: n3 } = s4, c3 = this._localOrigin;
    let p = 0;
    const h3 = d2(o2);
    if (h3 && o2.isWrappable) {
      const t4 = i6[0], d4 = i6[1], m = 180 / Math.PI * r7, f4 = Math.abs(Math.cos(m)), u3 = Math.abs(Math.sin(m)), M3 = Math.round(t4 * f4 + d4 * u3), [v3, _3] = h3.valid, w3 = ut(o2), { x: g, y: y3 } = n3.targetGeometry, j3 = [g, y3], R2 = [0, 0];
      s4.toScreen(R2, j3);
      const b2 = [0, 0];
      let O;
      O = M3 > a3 ? 0.5 * a3 : 0.5 * M3;
      const P = Math.floor((g + 0.5 * w3) / w3), x2 = v3 + P * w3, C = _3 + P * w3, D2 = [R2[0] + O, 0];
      s4.toMap(b2, D2), b2[0] > C && (p = w3), D2[0] = R2[0] - O, s4.toMap(b2, D2), b2[0] < x2 && (p = -w3);
      for (const s5 of e5) {
        const t5 = s5.elementView.bounds;
        if (null == t5)
          continue;
        const [e6, , r8] = t5;
        e6 < v3 && r8 > v3 ? s5.updateDrawCoords(c3, w3) : r8 > _3 && e6 < _3 ? s5.updateDrawCoords(c3, -w3) : s5.updateDrawCoords(c3, p);
      }
    } else
      for (const d4 of e5)
        d4.updateDrawCoords(c3, p);
  }
};

// node_modules/@arcgis/core/views/2d/layers/MediaLayerView2D.js
var w2 = class extends f3(d3) {
  constructor() {
    super(...arguments), this._overlayContainer = null, this._fetchQueue = null, this._tileStrategy = null, this._elementReferences = /* @__PURE__ */ new Map(), this._debugGraphicsView = null, this.layer = null, this.elements = new V();
  }
  attach() {
    this.addAttachHandles([a2(() => this.layer.effectiveSource, "refresh", () => {
      this._tileStrategy.refresh((e5) => this._updateTile(e5)), this.requestUpdate();
    }), a2(() => this.layer.effectiveSource, "change", ({ element: e5 }) => this._elementUpdateHandler(e5))]), this._overlayContainer = new u2(), this.container.addChild(this._overlayContainer), this._fetchQueue = new y2({ tileInfoView: this.view.featuresTilingScheme, concurrency: 10, process: (e5, t3) => this._queryElements(e5, t3) }), this._tileStrategy = new r5({ cachePolicy: "purge", resampling: true, acquireTile: (e5) => this._acquireTile(e5), releaseTile: (e5) => this._releaseTile(e5), tileInfoView: this.view.featuresTilingScheme }), this.requestUpdate();
  }
  detach() {
    var _a;
    this.elements.removeAll(), this._tileStrategy.destroy(), this._fetchQueue.destroy(), this._overlayContainer.removeAllChildren(), this.container.removeAllChildren(), this._elementReferences.clear(), (_a = this._debugGraphicsView) == null ? void 0 : _a.destroy();
  }
  supportsSpatialReference(e5) {
    return true;
  }
  moveStart() {
    this.requestUpdate();
  }
  viewChange() {
    this.requestUpdate();
  }
  moveEnd() {
    this.requestUpdate();
  }
  update(e5) {
    var _a;
    this._tileStrategy.update(e5), (_a = this._debugGraphicsView) == null ? void 0 : _a.update(e5);
  }
  async hitTest(e5, t3) {
    const r7 = [], i6 = e5.normalize(), s4 = [i6.x, i6.y];
    for (const { projectedElement: { normalizedCoords: n3, element: o2 } } of this._elementReferences.values())
      null != n3 && s3(n3.rings, s4) && r7.push({ type: "media", element: o2, layer: this.layer, mapPoint: e5 });
    return r7.reverse();
  }
  canResume() {
    return null != this.layer.source && super.canResume();
  }
  async doRefresh() {
    this._fetchQueue.reset(), this._tileStrategy.refresh((e5) => this._updateTile(e5));
  }
  _acquireTile(e5) {
    const t3 = new T3(e5.clone());
    return this._updateTile(t3), t3;
  }
  _updateTile(e5) {
    this.updatingHandles.addPromise(this._fetchQueue.push(e5.key).then((t3) => {
      const [r7, i6] = e5.setElements(t3);
      this._referenceElements(e5, r7), this._dereferenceElements(e5, i6), this.requestUpdate();
    }, (e6) => {
      d(e6) || s.getLogger(this).error(e6);
    }));
  }
  _releaseTile(e5) {
    this._fetchQueue.abort(e5.key.id), e5.elements && this._dereferenceElements(e5, e5.elements), this.requestUpdate();
  }
  async _queryElements(e5, t3) {
    const r7 = this.layer.effectiveSource;
    if (null == r7)
      return [];
    this.view.featuresTilingScheme.getTileBounds(b, e5, true);
    const i6 = new M({ xmin: b[0], ymin: b[1], xmax: b[2], ymax: b[3], spatialReference: this.view.spatialReference });
    return r7.queryElements(i6, t3);
  }
  _referenceElements(e5, t3) {
    if (null != this.layer.source)
      for (const r7 of t3)
        this._referenceElement(e5, r7);
  }
  _referenceElement(e5, t3) {
    r(this._elementReferences, t3.uid, () => {
      const e6 = new i3({ element: t3, spatialReference: this.view.spatialReference }), r7 = new _(e6);
      this._overlayContainer.addChild(r7), this.elements.add(t3);
      let i6 = null;
      return { tiles: /* @__PURE__ */ new Set(), projectedElement: e6, overlay: r7, debugGraphic: i6 };
    }).tiles.add(e5);
  }
  _dereferenceElements(e5, t3) {
    for (const r7 of t3)
      this._dereferenceElement(e5, r7);
  }
  _dereferenceElement(e5, t3) {
    var _a;
    const r7 = this._elementReferences.get(t3.uid);
    r7.tiles.delete(e5), r7.tiles.size || (this._overlayContainer.removeChild(r7.overlay), r7.overlay.destroy(), r7.projectedElement.destroy(), this._elementReferences.delete(t3.uid), this.elements.remove(t3), (_a = this._debugGraphicsView) == null ? void 0 : _a.graphics.remove(r7.debugGraphic));
  }
  _elementUpdateHandler(e5) {
    var _a;
    let t3 = this._elementReferences.get(e5.uid);
    if (t3) {
      const r8 = t3.projectedElement.normalizedCoords;
      if (null == r8)
        return this._overlayContainer.removeChild(t3.overlay), t3.overlay.destroy(), t3.projectedElement.destroy(), this._elementReferences.delete(e5.uid), this.elements.remove(e5), void ((_a = this._debugGraphicsView) == null ? void 0 : _a.graphics.remove(t3.debugGraphic));
      const i6 = [], s4 = [];
      for (const e6 of this._tileStrategy.tiles) {
        const n3 = v2(this.view.featuresTilingScheme, e6, r8);
        t3.tiles.has(e6) ? n3 || s4.push(e6) : n3 && i6.push(e6);
      }
      for (const t4 of i6)
        this._referenceElement(t4, e5);
      for (const t4 of s4)
        this._dereferenceElement(t4, e5);
      return t3 = this._elementReferences.get(e5.uid), void ((t3 == null ? void 0 : t3.debugGraphic) && (t3.debugGraphic.geometry = t3.projectedElement.normalizedCoords, this._debugGraphicsView.graphicUpdateHandler({ graphic: t3.debugGraphic, property: "geometry" })));
    }
    const r7 = new i3({ element: e5, spatialReference: this.view.spatialReference }).normalizedCoords;
    if (null != r7)
      for (const i6 of this._tileStrategy.tiles) {
        v2(this.view.featuresTilingScheme, i6, r7) && this._referenceElement(i6, e5);
      }
  }
};
e([y()], w2.prototype, "_fetchQueue", void 0), e([y()], w2.prototype, "layer", void 0), e([y({ readOnly: true })], w2.prototype, "elements", void 0), w2 = e([a("esri.views.2d.layers.MediaLayerView2D")], w2);
var b = i();
var _2 = { xmin: 0, ymin: 0, xmax: 0, ymax: 0 };
function v2(e5, t3, r7) {
  return e5.getTileBounds(b, t3.key, true), _2.xmin = b[0], _2.ymin = b[1], _2.xmax = b[2], _2.ymax = b[3], x(_2, r7);
}
var T3 = class {
  constructor(e5) {
    this.key = e5, this.elements = null, this.isReady = false, this.visible = true;
  }
  setElements(e5) {
    const t3 = [], r7 = new Set(this.elements);
    this.elements = e5;
    for (const i6 of e5)
      r7.has(i6) ? r7.delete(i6) : t3.push(i6);
    return this.isReady = true, [t3, Array.from(r7)];
  }
  destroy() {
  }
};
var R = w2;
export {
  R as default
};
//# sourceMappingURL=MediaLayerView2D-CZ3FBA23.js.map
